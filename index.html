<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BugFixer AI - Enterprise Grade Code Repair</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'ui-sans-serif', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
                        mono: ['JetBrains Mono', 'ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', 'Liberation Mono', 'Courier New', 'monospace'],
                    },
                    colors: {
                        primary: {
                            DEFAULT: '#6366f1', 
                            hover: '#4f46e5',    
                            active: '#4338ca',   
                        },
                        secondary: {
                             DEFAULT: '#10b981', 
                        },
                        dark: {
                            950: '#020617', 
                            900: '#0f172a', 
                            800: '#1e293b', 
                            700: '#334155', 
                            600: '#475569', 
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'spin-slow': 'spin 3s linear infinite',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    },
                    backgroundImage: {
                        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        body {
             font-feature-settings: "ss01", "ss03", "cv05", "cv11"; 
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.6); 
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06), inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        .glass-panel-highlight {
             background: rgba(30, 41, 59, 0.5);
             border: 1px solid rgba(99, 102, 241, 0.2); 
        }

        .bg-grid-pattern {
            background-size: 50px 50px;
            background-image: linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            mask-image: radial-gradient(ellipse 100% 100% at 50% 0%, black 40%, transparent 100%);
        }
        
        .glow-primary {
            box-shadow: 0 0 40px -10px rgba(99, 102, 241, 0.3);
        }
    </style>
</head>
<body class="bg-dark-950 text-slate-300 min-h-screen font-sans selection:bg-primary/30 overflow-x-hidden">

    <div class="fixed inset-0 pointer-events-none bg-dark-950 z-0">
         <div class="absolute inset-0 bg-[radial-gradient(ellipse_80%_80%_at_50%_-20%,rgba(99,102,241,0.15),rgba(255,255,255,0))]"></div>
         <div class="absolute inset-0 bg-grid-pattern z-0"></div>
    </div>

    <nav id="main-nav" class="fixed w-full z-50 top-0 start-0 border-b border-white/5 glass-panel">
        <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
            <a href="#" onclick="navigateTo('landing')" class="flex items-center space-x-2 rtl:space-x-reverse z-10 group">
                <div class="p-2 bg-gradient-to-br from-primary to-primary-active rounded-xl shadow-lg shadow-primary/20 group-hover:shadow-primary/40 transition-all duration-300">
                    <i data-lucide="bug" class="w-5 h-5 text-white"></i>
                </div>
                <span class="self-center text-xl font-bold whitespace-nowrap text-white tracking-tight">BugFixer<span class="text-primary">.ai</span></span>
            </a>
            <div class="flex md:order-2 space-x-3 md:space-x-0 rtl:space-x-reverse">
                <div id="nav-auth-buttons">
                    <button onclick="navigateTo('login')" class="text-white bg-primary hover:bg-primary-hover focus:ring-4 focus:outline-none focus:ring-primary/30 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-all shadow-lg shadow-primary/20">
                        Sign In
                    </button>
                </div>
                <div id="nav-user-menu" class="hidden flex items-center gap-6">
                     <div class="text-sm text-slate-400 flex items-center gap-2 bg-dark-800/50 px-4 py-2 rounded-full border border-white/5">
                        <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                        <span><span id="user-name-display" class="text-slate-200 font-medium">Dev</span></span>
                     </div>
                     <button onclick="logout()" class="text-slate-400 hover:text-white transition-colors flex items-center gap-2 text-sm">
                        <i data-lucide="log-out" class="w-4 h-4"></i>
                        <span>Logout</span>
                     </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="relative z-10 pt-24 min-h-screen flex flex-col">

        <section id="landing-page" class="page-section flex-grow flex items-center">
            <div class="py-8 px-4 mx-auto max-w-screen-xl text-center lg:py-24 lg:px-12">
                
                <div class="inline-flex items-center py-1 px-1 pr-4 mb-8 text-sm text-slate-400 bg-dark-900/80 rounded-full border border-white/10 hover:border-primary/50 transition-colors cursor-default backdrop-blur-md" role="alert">
                    <span class="text-xs bg-primary/20 text-primary border border-primary/30 rounded-full px-3 py-1 font-semibold mr-3">New V2.0</span> 
                    <span class="font-medium">Context-aware directory scanning</span>
                </div>

                <h1 class="mb-6 text-5xl font-extrabold tracking-tight leading-tight text-white md:text-6xl lg:text-7xl">
                   Automated Code Repair<br>
                   <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary via-indigo-400 to-secondary animate-pulse-slow">Enterprise Standard.</span>
                </h1>
                <p class="mb-10 text-lg font-normal text-slate-400 lg:text-xl sm:px-16 xl:px-48 max-w-4xl mx-auto leading-relaxed">
                    Securely upload your entire repository. Our advanced LLM agents analyze structure, dependencies, and your specific instructions to fix bugs while preserving your exact architecture.
                </p>

                <div class="flex flex-col mb-16 space-y-4 sm:flex-row sm:justify-center sm:space-y-0 sm:space-x-6">
                    <button onclick="navigateTo('login')" class="inline-flex justify-center items-center py-4 px-8 text-base font-semibold text-center text-white rounded-xl bg-primary hover:bg-primary-hover focus:ring-4 focus:ring-primary/30 transition-all shadow-xl shadow-primary/25 hover:scale-105 active:scale-95 duration-200">
                        Start Free Trial
                        <i data-lucide="arrow-right" class="ml-2 -mr-1 w-5 h-5"></i>
                    </button>
                    <a href="#features" class="inline-flex justify-center items-center py-4 px-8 text-base font-medium text-center text-slate-300 rounded-xl border border-dark-700 bg-dark-800/30 hover:bg-dark-800 focus:ring-4 focus:ring-dark-700 transition-all hover:text-white backdrop-blur-sm">
                        <i data-lucide="terminal-square" class="mr-2 w-5 h-5"></i>
                        View Documentation
                    </a>
                </div>

                <div class="text-sm text-slate-500 font-medium uppercase tracking-widest mb-8">Trusted by engineers at</div>
                <div class="flex justify-center items-center gap-8 opacity-40 grayscale hover:grayscale-0 hover:opacity-100 transition-all duration-500">
                     <span class="font-bold text-xl flex items-center"><i data-lucide="hexagon" class="mr-2"></i> ACME Corp</span>
                     <span class="font-bold text-xl flex items-center"><i data-lucide="boxes" class="mr-2"></i> OmniStack</span>
                     <span class="font-bold text-xl flex items-center"><i data-lucide="cpu" class="mr-2"></i> FutureSystems</span>
                </div>
            </div>
        </section>

        <section id="login-page" class="page-section hidden flex-grow flex items-center justify-center">
            <div class="w-full flex flex-col items-center justify-center px-6 py-12 mx-auto">
                <div class="w-full glass-panel rounded-2xl shadow-2xl md:mt-0 sm:max-w-md xl:p-0 border border-white/10 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-primary via-secondary to-primary"></div>
                    
                    <div class="p-8 space-y-6">
                        <div class="text-center">
                            <h1 class="text-2xl font-bold leading-tight tracking-tight text-white mb-2">
                                Welcome Back
                            </h1>
                            <p class="text-slate-400 text-sm">Sign in to access your secure dashboard</p>
                        </div>

                        <form class="space-y-5" onsubmit="handleLogin(event)">
                            <div>
                                <label for="email" class="block mb-2 text-sm font-medium text-slate-300">Work Email</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-slate-500">
                                        <i data-lucide="mail" class="w-5 h-5"></i>
                                    </div>
                                    <input type="email" name="email" id="email" class="bg-dark-900/50 border border-dark-700 text-white sm:text-sm rounded-lg focus:ring-primary focus:border-primary block w-full pl-10 p-3 placeholder-slate-600 transition-colors focus:bg-dark-900" placeholder="name@company.com" required value="demo@bugfixer.ai">
                                </div>
                            </div>
                            <div>
                                <label for="password" class="block mb-2 text-sm font-medium text-slate-300">Password</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-slate-500">
                                        <i data-lucide="lock" class="w-5 h-5"></i>
                                    </div>
                                    <input type="password" name="password" id="password" placeholder="••••••••" class="bg-dark-900/50 border border-dark-700 text-white sm:text-sm rounded-lg focus:ring-primary focus:border-primary block w-full pl-10 p-3 placeholder-slate-600 transition-colors focus:bg-dark-900" required value="password">
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div class="flex items-start">
                                    <div class="flex items-center h-5">
                                      <input id="remember" aria-describedby="remember" type="checkbox" class="w-4 h-4 border border-dark-700 rounded bg-dark-900 focus:ring-3 focus:ring-primary/30 accent-primary">
                                    </div>
                                    <div class="ml-3 text-sm">
                                      <label for="remember" class="text-slate-400">Remember me</label>
                                    </div>
                                </div>
                                <a href="#" class="text-sm font-medium text-primary hover:underline">Forgot password?</a>
                            </div>

                            <button type="submit" class="w-full text-white bg-primary hover:bg-primary-hover focus:ring-4 focus:outline-none focus:ring-primary/30 font-semibold rounded-lg text-sm px-5 py-3.5 text-center transition-all shadow-lg shadow-primary/20">Sign in securely</button>
                            
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <section id="dashboard-page" class="page-section hidden">
            <div class="max-w-screen-xl mx-auto px-4 py-8">
                <div class="flex justify-between items-end mb-8">
                    <div>
                        <h2 class="text-3xl font-bold text-white mb-2">Overview</h2>
                        <p class="text-slate-400">Manage your projects and track AI performance.</p>
                    </div>
                    <div class="text-right hidden md:block">
                         <span class="text-xs font-mono text-slate-500 uppercase">System Status</span>
                         <div class="flex items-center gap-2 text-green-500 text-sm font-medium">
                             <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                             All Systems Operational
                         </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
                    <div onclick="navigateTo('upload')" class="md:col-span-2 glass-panel p-8 rounded-2xl flex items-center justify-between cursor-pointer border-primary/30 hover:border-primary transition-all group relative overflow-hidden glow-primary">
                        <div class="absolute inset-0 bg-gradient-to-r from-primary/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                        <div class="flex items-center gap-6 relative z-10">
                            <div class="p-4 bg-primary text-white rounded-xl shadow-lg shadow-primary/30 group-hover:scale-110 transition-transform duration-300">
                                <i data-lucide="plus" class="w-8 h-8"></i>
                            </div>
                            <div>
                                <h4 class="text-2xl font-bold text-white mb-1">New Repair Job</h4>
                                <p class="text-slate-300">Upload a project for analysis</p>
                            </div>
                        </div>
                        <div class="w-12 h-12 rounded-full border border-white/10 flex items-center justify-center group-hover:bg-white/10 transition-colors">
                             <i data-lucide="arrow-right" class="text-slate-400 group-hover:text-white transition-colors"></i>
                        </div>
                    </div>

                    <div class="glass-panel p-6 rounded-2xl">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="p-2 bg-secondary/10 text-secondary rounded-lg">
                                <i data-lucide="bug-off" class="w-6 h-6"></i>
                            </div>
                            <span class="text-slate-400 text-sm font-medium">Total Fixed</span>
                        </div>
                        <h4 class="text-4xl font-extrabold text-white tracking-tight" id="stat-fixed">0</h4>
                    </div>
                     <div class="glass-panel p-6 rounded-2xl">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="p-2 bg-blue-500/10 text-blue-400 rounded-lg">
                                <i data-lucide="file-code-2" class="w-6 h-6"></i>
                            </div>
                            <span class="text-slate-400 text-sm font-medium">Files Scanned</span>
                        </div>
                        <h4 class="text-4xl font-extrabold text-white tracking-tight" id="stat-files">0</h4>
                    </div>
                </div>

                <div class="glass-panel rounded-2xl overflow-hidden border border-white/5">
                    <div class="p-6 border-b border-white/5 flex justify-between items-center bg-white/[0.02]">
                        <h3 class="text-lg font-semibold text-white">Recent Activity</h3>
                        <button class="text-sm text-primary hover:text-primary-hover font-medium flex items-center">
                            View All <i data-lucide="chevron-right" class="w-4 h-4 ml-1"></i>
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-slate-400">
                            <thead class="text-xs uppercase bg-dark-950/50 text-slate-500 font-semibold tracking-wider">
                                <tr>
                                    <th scope="col" class="px-6 py-5">Project Name</th>
                                    <th scope="col" class="px-6 py-5">Status</th>
                                    <th scope="col" class="px-6 py-5">Efficiency</th>
                                    <th scope="col" class="px-6 py-5 text-right">Date</th>
                                </tr>
                            </thead>
                            <tbody id="recent-activity-body" class="divide-y divide-white/5">
                                <tr class="hover:bg-white/[0.02] transition-colors">
                                    <td class="px-6 py-4 font-medium text-slate-500 italic" colspan="4" class="text-center">
                                        No recent projects found.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <section id="upload-page" class="page-section hidden flex-grow flex flex-col">
            <div class="max-w-4xl mx-auto w-full px-4 py-12 flex-grow flex flex-col justify-center">
                <div class="text-center mb-10">
                    <h2 class="text-4xl font-bold text-white mb-4">Upload Codebase</h2>
                    <p class="text-slate-400 text-lg max-w-2xl mx-auto">Drag and drop your project root folder. We support all major languages including JS, Python, Java, and Rust.</p>
                </div>

                <div id="dropzone" class="relative group flex flex-col items-center justify-center w-full h-96 border-2 border-dashed border-dark-700 rounded-3xl bg-dark-900/30 hover:bg-dark-800/50 hover:border-primary/50 transition-all cursor-pointer overflow-hidden backdrop-blur-sm">

                    <div class="z-10 flex flex-col items-center justify-center pt-5 pb-6 text-center px-4 transition-all duration-300 group-hover:-translate-y-2" id="dropzone-content">
                         <div class="p-6 bg-dark-950 rounded-2xl mb-6 group-hover:scale-110 transition-transform shadow-2xl shadow-primary/5 border border-white/5 group-hover:border-primary/20">
                            <i data-lucide="folder-git-2" class="w-16 h-16 text-primary"></i>
                        </div>
                        <p class="mb-3 text-2xl font-semibold text-white">Drag project folder here</p>
                        <p class="mb-6 text-slate-400">or <span class="text-primary hover:underline">browse files</span></p>
                        
                        <div class="flex gap-3">
                             <span class="px-3 py-1.5 bg-dark-950 rounded-md text-xs font-mono font-medium text-slate-500 border border-white/5 flex items-center">
                                <i data-lucide="file-code" class="w-3 h-3 mr-1.5"></i> .js
                            </span>
                            <span class="px-3 py-1.5 bg-dark-950 rounded-md text-xs font-mono font-medium text-slate-500 border border-white/5 flex items-center">
                                <i data-lucide="file-json" class="w-3 h-3 mr-1.5"></i> .json
                            </span>
                             <span class="px-3 py-1.5 bg-dark-950 rounded-md text-xs font-mono font-medium text-slate-500 border border-white/5 flex items-center">
                                <i data-lucide="file-type-2" class="w-3 h-3 mr-1.5"></i> .py
                            </span>
                             <span class="px-3 py-1.5 bg-dark-950 rounded-md text-xs font-mono font-medium text-slate-400 border border-white/5">
                                + many more
                            </span>
                        </div>
                    </div>

                    <input id="file-upload" type="file" class="hidden" multiple webkitdirectory directory />

                    <div class="absolute inset-0 bg-gradient-to-tr from-primary/5 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"></div>
                </div>

                 <div class="mt-8 text-center">
                     <button onclick="navigateTo('dashboard')" class="text-slate-500 hover:text-slate-300 text-sm font-medium transition-colors flex items-center justify-center mx-auto">
                        <i data-lucide="arrow-left" class="mr-2 w-4 h-4"></i>
                        Cancel and return to dashboard
                    </button>
                </div>
            </div>
        </section>

        <section id="configure-page" class="page-section hidden flex-grow flex flex-col">
            <div class="max-w-3xl mx-auto w-full px-4 py-12 flex-grow flex flex-col justify-center">
                
                <div class="mb-8">
                     <button onclick="navigateTo('upload')" class="text-slate-400 hover:text-white text-sm font-medium transition-colors flex items-center mb-6">
                        <i data-lucide="arrow-left" class="mr-2 w-4 h-4"></i>
                        Back to Upload
                    </button>
                    <h2 class="text-3xl font-bold text-white mb-2">Configure Repair Job</h2>
                    <p class="text-slate-400">Give our AI agent context to improve accuracy.</p>
                </div>

                <div class="glass-panel p-8 rounded-2xl space-y-8">
                    
                    <div class="flex items-center p-4 bg-primary/10 border border-primary/20 rounded-xl text-primary">
                        <i data-lucide="folder-check" class="w-6 h-6 mr-4"></i>
                        <div>
                            <div class="font-semibold text-white" id="config-folder-name">Project Name</div>
                            <div class="text-sm opacity-80"><span id="config-file-count">0</span> files ready for analysis</div>
                        </div>
                    </div>

                    <div>
                        <label for="user-instructions" class="block mb-3 text-sm font-medium text-white flex items-center justify-between">
                            <span>Bug Description & Instructions <span class="text-slate-500 font-normal">(Optional but recommended)</span></span>
                        </label>
                        <div class="relative">
                            <textarea id="user-instructions" rows="6" class="block p-4 w-full text-sm text-white bg-dark-950/50 rounded-xl border border-dark-700 focus:ring-primary focus:border-primary placeholder-slate-600 resize-none font-mono" placeholder="e.g., &#10;- There is a memory leak in the parser.js file when handling large JSON objects.&#10;- Please upgrade all React components to use functional hooks instead of classes.&#10;- Fix any security vulnerabilities related to user input sanitization."></textarea>
                            <div class="absolute bottom-3 right-3 text-xs text-slate-600 pointer-events-none">
                                AI Context Window: 128k tokens
                            </div>
                        </div>
                    </div>

                    <div class="space-y-3">
                        <label class="text-sm font-medium text-white block mb-3">Additional Optimizations</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <label class="flex items-center p-4 border border-dark-700 rounded-xl cursor-pointer hover:bg-white/5 transition-colors group">
                                <input id="opt-lint" type="checkbox" class="w-5 h-5 text-primary bg-dark-900 border-dark-700 rounded focus:ring-primary focus:ring-2 accent-primary">
                                <div class="ml-4">
                                    <span class="text-sm font-medium text-white group-hover:text-primary transition-colors">Fix Linting Errors</span>
                                    <p class="text-xs text-slate-500">Standardize formatting (Prettier/ESLint)</p>
                                </div>
                            </label>
                            <label class="flex items-center p-4 border border-dark-700 rounded-xl cursor-pointer hover:bg-white/5 transition-colors group">
                                <input id="opt-comments" type="checkbox" checked class="w-5 h-5 text-primary bg-dark-900 border-dark-700 rounded focus:ring-primary focus:ring-2 accent-primary">
                                <div class="ml-4">
                                    <span class="text-sm font-medium text-white group-hover:text-primary transition-colors">Add Explanatory Comments</span>
                                    <p class="text-xs text-slate-500">Document complex fixes</p>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="pt-6 border-t border-white/5 flex justify-end gap-4">
                        <button onclick="startProcessingFlow()" class="inline-flex items-center justify-center py-4 px-8 text-base font-semibold text-white rounded-xl bg-primary hover:bg-primary-hover focus:ring-4 focus:ring-primary/30 transition-all shadow-lg shadow-primary/20 hover:scale-[1.02] active:scale-[0.98]">
                            <i data-lucide="sparkles" class="mr-2.5 w-5 h-5"></i>
                            Start AI Analysis
                        </button>
                    </div>
                </div>

            </div>
        </section>

        <section id="processing-page" class="page-section hidden flex-grow flex flex-col justify-center">
            <div class="max-w-3xl mx-auto w-full px-4 py-12 text-center">
                
                <div class="relative flex justify-center items-center mb-12 scale-110">
                    <div class="absolute animate-spin-slow w-48 h-48 rounded-full bg-gradient-to-tr from-primary/40 via-transparent to-secondary/40 blur-2xl"></div>
                    <div class="absolute animate-pulse-slow w-40 h-40 rounded-full border border-primary/20"></div>
                    <div class="absolute w-32 h-32 rounded-full border border-t-primary/80 border-r-primary/20 border-b-primary/80 border-l-primary/20 animate-spin"></div>
                    <div class="relative w-28 h-28 bg-dark-950 rounded-full flex items-center justify-center border border-white/10 z-10 shadow-2xl">
                         <i data-lucide="cpu" class="w-12 h-12 text-primary animate-pulse"></i>
                    </div>
                </div>

                <h2 class="text-3xl font-bold text-white mb-3" id="processing-status">Initializing Agents...</h2>
                <p class="text-slate-400 mb-10 text-lg" id="processing-details">Allocating secure sandbox environment...</p>

                <div class="w-full max-w-2xl mx-auto glass-panel rounded-xl text-left overflow-hidden border border-dark-800 shadow-2xl">
                     <div class="bg-dark-950 px-4 py-2 flex items-center gap-2 border-b border-white/5">
                         <div class="flex gap-1.5">
                             <div class="w-3 h-3 rounded-full bg-red-500/50"></div>
                             <div class="w-3 h-3 rounded-full bg-yellow-500/50"></div>
                             <div class="w-3 h-3 rounded-full bg-green-500/50"></div>
                         </div>
                         <span class="text-xs text-slate-500 font-mono ml-2">agent-terminal --v2</span>
                     </div>
                    <div class="p-5 h-64 overflow-y-auto font-mono text-xs md:text-sm bg-dark-950/80 custom-scrollbar" id="terminal-logs">
                    </div>
                </div>

                <div class="max-w-2xl mx-auto mt-10">
                    <div class="flex justify-between text-xs font-medium text-slate-400 mb-3 px-1">
                        <span id="progress-stage">STAGE 1: INGESTION</span>
                        <span id="progress-percentage">0%</span>
                    </div>
                    <div class="w-full bg-dark-900 rounded-full h-3 overflow-hidden border border-white/5 p-[2px]">
                        <div id="progress-bar" class="bg-gradient-to-r from-primary to-secondary h-full rounded-full transition-all duration-300 ease-out relative overflow-hidden" style="width: 0%">
                             <div class="absolute inset-0 bg-white/20 animate-pulse-fast"></div>
                        </div>
                    </div>
                    <div class="text-right mt-2 text-xs text-slate-600" id="progress-count">0/0 files processed</div>
                </div>
            </div>
        </section>

         <section id="result-page" class="page-section hidden flex-grow flex flex-col justify-center">
            <div class="max-w-3xl mx-auto w-full px-4 py-16 text-center relative z-10">
                
                <div class="mb-8 relative inline-block">
                    <div class="absolute inset-0 bg-green-500/20 blur-3xl rounded-full animate-pulse-slow"></div>
                    <div class="relative inline-flex p-6 bg-gradient-to-br from-green-500/20 to-green-500/5 rounded-full text-green-400 ring-1 ring-green-500/30 shadow-2xl">
                        <i data-lucide="check-check" class="w-20 h-20"></i>
                    </div>
                </div>

                <h1 class="text-5xl font-extrabold text-white mb-4 tracking-tight">Repair Successful</h1>
                <p class="text-xl text-slate-300 mb-12 max-w-xl mx-auto">
                    Your codebase has been optimized according to your instructions. All <span id="result-file-count" class="text-white font-bold">0</span> files are ready.
                </p>

                <div class="glass-panel p-1 rounded-3xl max-w-xl mx-auto mb-12 bg-gradient-to-b from-white/10 to-transparent">
                    <div class="bg-dark-950/80 p-8 rounded-[22px] backdrop-blur-md">
                         <h3 class="text-base font-semibold text-slate-300 mb-6 flex items-center uppercase tracking-wider text-xs">
                            <i data-lucide="clipboard-check" class="mr-2 w-4 h-4 text-primary"></i>
                            Execution Report
                        </h3>
                         <ul class="space-y-4 text-left" id="result-summary-list">
                         </ul>
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <button onclick="downloadFixedProject()" id="download-btn" class="group relative inline-flex items-center justify-center px-8 py-4 font-bold text-white transition-all bg-primary hover:bg-primary-hover rounded-xl focus:outline-none focus:ring-4 focus:ring-primary/30 shadow-xl shadow-primary/30 hover:-translate-y-1">
                        <i data-lucide="download" class="mr-3 w-5 h-5 group-hover:animate-bounce"></i>
                        Download Fixed Repository
                    </button>
                    <button onclick="navigateTo('dashboard')" class="inline-flex items-center justify-center px-8 py-4 font-semibold text-slate-300 transition-all bg-dark-800 hover:bg-dark-700 rounded-xl border border-white/5 hover:text-white">
                        Return to Dashboard
                    </button>
                </div>
            </div>
        </section>

    </main>

   <script>
lucide.createIcons();

let currentUser = null;
let uploadedFilesCache = [];
let fixedZipBlob = null;
let userConfig = { instructions: "", optLint: false, optComments: true };

function navigateTo(pageId) {
  document.querySelectorAll('.page-section').forEach(s => s.classList.add('hidden'));
  document.getElementById(`${pageId}-page`).classList.remove('hidden');
  window.scrollTo(0,0);
  const authButtons = document.getElementById('nav-auth-buttons');
  const userMenu = document.getElementById('nav-user-menu');
  if (currentUser) {
    authButtons.classList.add('hidden');
    userMenu.classList.remove('hidden');
    document.getElementById('user-name-display').textContent = currentUser.name;
  } else {
    authButtons.classList.remove('hidden');
    userMenu.classList.add('hidden');
  }
}

function handleLogin(e) {
  e.preventDefault();
  const email = document.getElementById('email').value;
  const btn = e.target.querySelector('button[type="submit"]');
  const original = btn.innerHTML;
  btn.innerHTML = '<i data-lucide="loader-2" class="animate-spin w-5 h-5 mx-auto"></i>';
  btn.disabled = true; lucide.createIcons();
  setTimeout(() => {
    currentUser = { name: email.split('@')[0], email };
    localStorage.setItem('bugfixer_user_v2', JSON.stringify(currentUser));
    navigateTo('dashboard');
    btn.innerHTML = original; btn.disabled = false;
    updateDashboard();
  }, 800);
}
function logout(){ currentUser=null; localStorage.removeItem('bugfixer_user_v2'); navigateTo('landing'); }

function updateDashboard(){
  if (document.getElementById('stat-fixed').textContent === '0') {
    document.getElementById('stat-fixed').textContent = Math.floor(Math.random()*100);
    document.getElementById('stat-files').textContent = Math.floor(Math.random()*5000);
  }
}

const dropzone = document.getElementById('dropzone');
const fileInput = document.getElementById('file-upload');
dropzone.addEventListener('click', () => fileInput.click());

['dragenter','dragover'].forEach(evt => dropzone.addEventListener(evt, e => { e.preventDefault(); e.stopPropagation(); dropzone.classList.add('border-primary','bg-dark-800/50'); }, false));
['dragleave','drop'].forEach(evt => dropzone.addEventListener(evt, e => { e.preventDefault(); e.stopPropagation(); dropzone.classList.remove('border-primary','bg-dark-800/50'); }, false));
dropzone.addEventListener('drop', e => handleFiles(e.dataTransfer.files));
fileInput.addEventListener('change', e => handleFiles(e.target.files));

function handleFiles(fileList) {
  if (!fileList || fileList.length === 0) return;
  uploadedFilesCache = Array.from(fileList);
  prepareConfigurationPage();
  navigateTo('configure');
}

function prepareConfigurationPage() {
  const first = uploadedFilesCache[0] || {};
  const webkitPath = first.webkitRelativePath || first.name || "Uploaded Project";
  const rootName = (webkitPath.split && webkitPath.split('/')[0]) || "Uploaded Project";
  document.getElementById('config-folder-name').textContent = rootName;
  document.getElementById('config-file-count').textContent = uploadedFilesCache.length;
  document.getElementById('user-instructions').value = "";
  document.getElementById('opt-lint').checked = false;
  document.getElementById('opt-comments').checked = true;
}

function startProcessingFlow() {
  userConfig.instructions = document.getElementById('user-instructions').value;
  userConfig.optLint = document.getElementById('opt-lint').checked;
  userConfig.optComments = document.getElementById('opt-comments').checked;
  startProcessing(uploadedFilesCache);
}

function terminalLog(msg, type='info') {
  const term = document.getElementById('terminal-logs');
  const time = new Date().toLocaleTimeString('en-US',{hour12:false});
  let cls='text-slate-300', pre='ℹ';
  if (type==='error'){cls='text-red-400';pre='✖';}
  if (type==='success'){cls='text-green-400';pre='✔';}
  if (type==='warning'){cls='text-yellow-400';pre='⚠';}
  if (type==='system'){cls='text-primary';pre='⚡';}
  term.innerHTML += `<div class="mb-1 font-mono"><span class="text-slate-600">[${time}]</span> <span class="${cls}">${pre} ${msg}</span></div>`;
  term.scrollTop = term.scrollHeight;
}

async function startProcessing(files) {
  navigateTo('processing');
  const progressBar = document.getElementById('progress-bar');
  const progressCount = document.getElementById('progress-count');
  const progressPercent = document.getElementById('progress-percentage');
  const progressStage = document.getElementById('progress-stage');
  const statusMsg = document.getElementById('processing-status');
  const detailsMsg = document.getElementById('processing-details');
  const terminal = document.getElementById('terminal-logs');
  terminal.innerHTML = '';

  if (!files || files.length === 0) { terminalLog("No files to process.", 'error'); return; }

  const form = new FormData();
  form.append('instructions', userConfig.instructions || '');
  form.append('optLint', userConfig.optLint ? '1':'0');
  form.append('optComments', userConfig.optComments ? '1':'0');

  const allowedRegex = /\.(js|jsx|ts|tsx|py|java|cpp|c|cs|go|rs|php|rb|html|css|json|md)$/i;
  const toSend = [];
  for (const f of files) {
    const name = f.webkitRelativePath || f.name;
    if (allowedRegex.test(name)) { form.append('files', f, name); toSend.push(name); }
    else { console.warn('Skipping non-code file:', name); }
  }
  if (toSend.length === 0) { terminalLog("No supported code files found to upload.", 'warning'); alert("No supported code files found to upload."); return; }

  const endpoint = (location.hostname === "localhost" || location.hostname === "127.0.0.1")
    ? "http://localhost:5000/fix"
    : "https://bugfixer-ai-backend-pye4sqj24a-uc.a.run.app/"; 

  progressStage.textContent = "STAGE 1: UPLOADING";
  statusMsg.textContent = "Preparing upload...";
  detailsMsg.textContent = `Files to upload: ${toSend.length}`;

  try {
    terminalLog("Initializing upload to backend...", 'system');

    const xhr = new XMLHttpRequest();
    xhr.open('POST', endpoint, true);
    xhr.responseType = 'blob';

    xhr.upload.onprogress = function(evt) {
      if (!evt.lengthComputable) return;
      const percent = Math.round((evt.loaded / evt.total) * 100);
      progressBar.style.width = percent + '%';
      progressPercent.textContent = percent + '%';
      progressCount.textContent = `Uploading: ${Math.round(evt.loaded/1024)} KB / ${Math.round(evt.total/1024)} KB`;
      statusMsg.textContent = "Uploading files...";
    };

    xhr.upload.onloadstart = function() { terminalLog(`Upload started (${toSend.length} files)...`, 'system'); };
    xhr.upload.onerror = function() { terminalLog("Upload failed due to a network error.", 'error'); statusMsg.textContent = "Upload error"; };

    xhr.onreadystatechange = function() {
      if (xhr.readyState === 2) {
        progressStage.textContent = "STAGE 2: PROCESSING";
        statusMsg.textContent = "Server received files. Processing with Gemini...";
        terminalLog("Server acknowledged upload. Awaiting processing...", 'system');
      }
      if (xhr.readyState === 4) {
        if (xhr.status >= 200 && xhr.status < 300) {
          const blob = xhr.response;
          fixedZipBlob = blob;
          terminalLog("Received fixed repository from server.", 'success');

          progressBar.style.width = '100%';
          progressPercent.textContent = '100%';
          progressCount.textContent = `${toSend.length}/${toSend.length} uploaded`;
          progressStage.textContent = "STAGE 3: COMPLETE";
          statusMsg.textContent = "Processing complete. Preparing download...";
          detailsMsg.textContent = `Files processed: ${toSend.length}`;

          try {
            if (window.saveAs) saveAs(blob, `fixed_repo_${Date.now()}.zip`);
            else {
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url; a.download = `fixed_repo_${Date.now()}.zip`;
              document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
            }
          } catch (err) { console.warn("Auto-download failed:", err); }

          showResults(toSend.length, (uploadedFilesCache[0]?.webkitRelativePath || uploadedFilesCache[0]?.name || 'project').split('/')[0]);
        } else {
          const reader = new FileReader();
          reader.onload = function() {
            const text = reader.result;
            const msg = `Server error (${xhr.status}): ${text}`;
            terminalLog(msg, 'error');
            alert(msg);
            statusMsg.textContent = "Server error";
            progressStage.textContent = "ERROR";
          };
          reader.readAsText(xhr.response);
        }
      }
    };

    xhr.timeout = 1000 * 60 * 10;
    xhr.ontimeout = function() { terminalLog("Request timed out. Try smaller batches or check server logs.", 'error'); alert("Request timed out."); };

    xhr.send(form);

  } catch (err) {
    console.error(err);
    terminalLog(`Upload failed: ${err.message}`, 'error');
    alert("Upload failed: " + (err.message || err));
  }
}

function showResults(count, rootFolderName) {
  navigateTo('result');
  document.getElementById('result-file-count').textContent = count;
  const summaryList = document.getElementById('result-summary-list');
  let contextStatus = userConfig.instructions ?
    `<span class="text-secondary flex items-center"><i data-lucide="check" class="w-4 h-4 mr-1"></i> Applied</span>` :
    `<span class="text-slate-500">None provided</span>`;
  summaryList.innerHTML = `
    <li class="flex items-center justify-between py-3 border-b border-white/5">
      <span class="text-slate-400 font-medium">Project Root</span>
      <span class="text-white font-mono bg-white/5 px-2 py-1 rounded">${rootFolderName || 'root'}</span>
    </li>
    <li class="flex items-center justify-between py-3 border-b border-white/5">
      <span class="text-slate-400 font-medium">Files Processed</span>
      <span class="text-white font-semibold">${count}</span>
    </li>
    <li class="flex items-center justify-between py-3 border-b border-white/5">
      <span class="text-slate-400 font-medium">Custom Context</span>
      ${contextStatus}
    </li>
    <li class="flex items-center justify-between py-3">
      <span class="text-slate-400 font-medium">Security Scan</span>
      <span class="text-secondary flex items-center"><i data-lucide="shield-check" class="w-4 h-4 mr-1"></i> Passed</span>
    </li>`;
  lucide.createIcons();

  const currentFixed = parseInt(document.getElementById('stat-fixed').textContent) || 0;
  const currentFiles = parseInt(document.getElementById('stat-files').textContent) || 0;
  document.getElementById('stat-fixed').textContent = currentFixed + Math.floor(Math.random()*10) + 1;
  document.getElementById('stat-files').textContent = currentFiles + count;
  addRecentActivity(rootFolderName, count);
}

function addRecentActivity(name, files) {
  const tbody = document.getElementById('recent-activity-body');
  if (tbody.children[0]?.innerText.includes('No recent')) tbody.innerHTML = '';
  const row = document.createElement('tr');
  row.className = 'hover:bg-white/[0.02] transition-colors border-b border-white/5';
  row.innerHTML = `
    <th scope="row" class="px-6 py-4 font-medium text-white whitespace-nowrap flex items-center">
      <i data-lucide="git-branch" class="w-4 h-4 mr-2 text-primary"></i>${name}
    </th>
    <td class="px-6 py-4"><span class="bg-green-500/10 text-green-400 text-xs font-medium px-2.5 py-0.5 rounded-full border border-green-500/20">Completed</span></td>
    <td class="px-6 py-4 text-slate-400">High (+${Math.floor(Math.random()*20+80)}%)</td>
    <td class="px-6 py-4 text-right text-slate-500 font-mono text-xs">Just now</td>`;
  tbody.prepend(row);
  lucide.createIcons();
}

function downloadFixedProject() {
  if (!fixedZipBlob) { alert("Generation failed. Please try again."); return; }
  saveAs(fixedZipBlob, `bugfixer_repaired_${Date.now()}.zip`);
}

window.addEventListener('DOMContentLoaded', () => {
  const savedUser = localStorage.getItem('bugfixer_user_v2');
  if (savedUser) { currentUser = JSON.parse(savedUser); navigateTo('dashboard'); updateDashboard(); }
  else navigateTo('landing');
});
</script>

</body>
</html>
